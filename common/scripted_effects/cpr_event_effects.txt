cpr_get_prostitute_effect = {
	# Find an existing prostitute character
	random_pool_character = {
		province = $LOCATION$
		limit = {
			carn_is_prostitute_trigger = yes
			carn_is_working_as_prostitute_trigger = yes
			carn_can_have_sex_trigger = yes
			$CHARACTER$ = {
				is_attracted_to_gender_of = prev
			}
		}
		save_scope_as = $PROSTITUTE$
	}
	if = {
		limit = {
			NOT = { exists = scope:$PROSTITUTE$ }
		}

		# Create a new prostitute character
		$CHARACTER$ = {
			save_temporary_scope_as = attraction_check
		}
		create_character = {
			template = cpr_prostitute_character_template
			location = $LOCATION$
			gender_female_chance = cpr_attraction_based_female_chance
			dynasty = none
			culture = $LOCATION$.culture
			faith = $LOCATION$.faith
			save_temporary_scope_as = new_character
		}
		scope:new_character = {
			cpr_set_prostitute_sexuality_effect = { CHARACTER = $CHARACTER$ }
			save_scope_as = $PROSTITUTE$
		}
	}
}

cpr_add_prostitute_traits_effect = {
	# Lifestyle Prostitute / XP
	add_trait = lifestyle_prostitute
	add_trait_xp = {
		trait = lifestyle_prostitute
		value = {
			integer_range = {
				min = small_lifestyle_random_xp_low
				max = small_lifestyle_random_xp_high
			}
		}
	}

	# Fornicator
	add_trait = fornicator

	# Poet
	random = {
		chance = 1
		modifier = {
			add = 10
			culture = { has_cultural_parameter = poet_trait_more_common }
		}
		add_trait = poet
	}

	# Lifestyle Reveler XP
	if = {
		limit = { has_trait = lifestyle_reveler }
		add_trait_xp = {
			trait = lifestyle_reveler
			value = {
				integer_range = {
					min = small_lifestyle_random_xp_low
					max = small_lifestyle_random_xp_high
				}
			}
		}
	}

	# Loyal / Disloyal, weight
	set_interesting_traits_and_modifiers_effect = yes
}

cpr_set_prostitute_sexuality_effect = {
	random_list = {
		5 = {
			set_sexuality = bisexual
		}
		5 = {
			trigger = {
				OR = {
					AND = {
						is_female = yes
						$CHARACTER$ = { is_female = yes }
					}
					AND = {
						is_male = yes
						$CHARACTER$ = { is_male = yes }
					}
				}
			}
			set_sexuality = homosexual
		}
		10 = {
			trigger = {
				OR = {
					AND = {
						is_female = no
						$CHARACTER$ = { is_female = yes }
					}
					AND = {
						is_male = no
						$CHARACTER$ = { is_male = yes }
					}
				}
			}
			set_sexuality = heterosexual
		}
	}
}

cpr_prostitute_contract_std_effect = {
	random_list = {
		94 = {}
		5 = {
			contract_disease_notify_effect = { DISEASE = lovers_pox }
		}
		1 = {
			contract_disease_notify_effect = { DISEASE = great_pox }
		}
	}
}

cpr_prevent_pruning_effect = {
	set_variable = {
		name = last_visited_ruler
		value = dummy_female
		days = 1825
	}
}

cpr_set_origin_effect = {
	set_variable = {
		name = cpr_origin
		value = flag:$ORIGIN$
	}
}