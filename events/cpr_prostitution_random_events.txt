namespace = cpr_prostitution_random_events

scripted_trigger carn_possible_prostitute_random_events_0010_client_trigger = {
	is_ai = yes
	carn_can_have_sex_trigger = yes
	is_busy_in_events_localised = yes
	possibly_interested_in_character_trigger = { CHARACTER = root }
	root = { possibly_interested_in_character_trigger = { CHARACTER = prev } }
	gold >= minor_gold_value
	NOR = {
		this = root
		is_consort_of = root
		has_relation_lover = root
		has_relation_rival = root
		is_at_war_with = root
	}
}

# 0010. Someone notable lays with you - setup event
cpr_prostitution_random_events.0010 = {
	hidden = yes

	weight_multiplier = {
		base = 1
		# characters are less likely to be into you if you're a bad prostitute
		carn_prostitution_good_event_modifier = yes
	}

	immediate = {
		# first, populate a list with various important landed characters
		every_vassal = {
			add_to_list = potential_clients
		}
		if = {
			limit = { exists = liege }
			# CPR Add liege, fix adding liege's vassals
			liege = {
				add_to_list = potential_clients
				every_vassal = {
					add_to_list = potential_clients
				}
			}
		}
		# CPR Only add neighboring rulers if count or above to prevent errors
		if = {
			limit = { highest_held_title_tier >= tier_county }
			every_neighboring_and_across_water_realm_same_rank_owner = {
				add_to_list = potential_clients
			}
		}

		# now get one of them to be our client, preferably someone with a personality lewd enough that it makes sense for them to be coming to us
		random_in_list = {
			list = potential_clients
			limit = {
				carn_possible_prostitute_random_events_0010_client_trigger = yes
				OR = {
					has_trait = lustful
					has_trait = seducer
					has_trait = rakish
					has_trait = deviant
				}
			}
			weight = {
				base = 30
				modifier = {
					add = 10
					has_trait = lustful
				}
				modifier = {
					add = 10
					has_trait = seducer
				}
				modifier = {
					add = 10
					has_trait = rakish
				}
				modifier = {
					add = -10
					might_cheat_on_every_partner_trigger = no
				}
				modifier = {
					add = -30
					NOT = { freely_accepts_sodomy_with_trigger = { CHARACTER = root } }
				}
				# CPR Remove as it's impossible
				#modifier = {
				#	add = -30
				#	has_trait = chaste
				#}
			}
			save_scope_as = client
		}

		# CPR
		cpr_debug_log_1_effect = {
			MSG = cpr_debug_msg_prostitution_random_events_0010_fired
			NAME1 = client TYPE1 = flag:character
		}

		if = {
			limit = { exists = scope:client }
			trigger_event = { id = carn_prostitution_random_events.0011 }
		}
	}
}
